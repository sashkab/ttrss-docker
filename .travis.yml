sudo: required

services:
  - docker

before_install:
  - docker-compose build

install:
  - docker-compose up -d
  - sleep 5s && ./setup.sh
  - docker-compose restart

script:
  - sleep 5s
  - curl -I http://localhost
  - curl -sI http://localhost/config.php | grep 403
  - curl -sI http://localhost/cache | grep 403
  - curl -sI http://localhost/cache/ | grep 403
  - ./backup.sh && ls -la ~/.backup/ttrss*gz

after_script:
  - docker-compose down
  - docker volume rm ttrssdocker_ttrss ttrssdocker_pgdata
